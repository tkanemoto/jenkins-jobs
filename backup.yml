#
# Sync file system files using rsync
#
- job-template:
    name: 'sync-{name}-{source-host}'
    display-name: 'Sync {name}: {source-host}'
    node: '{source-host}'

    parameters:
      - string:
          name: SOURCE_DIR
          default: '{source-dir}'
      - string:
          name: TARGET_DIR
          default: '{target-dir}'
      - string:
          name: OPTIONS
          default: '{options}'

    triggers:
      - timed: '{trigger}'

    builders:
      - shell: |
          #!/bin/bash -ex
          rsync \
            --exclude .DS_Store \
            {options} {source-dir} {target-host}:{target-dir}

    publishers:
      - email:
          recipients: '{recipients}'

#
# Organize TV episodes
#
- job-template:
    name: 'organize-episodes-{host}-{name}'
    display-name: 'Organize episodes: {host} {name}'
    node: '{host}'

    triggers:
      - timed: '{trigger}'

    builders:
      - shell: |
          #!/bin/bash -ex
          rm -rf python-mlib
          git clone https://github.com/tkanemoto/python-mlib
      - shell: |
          #!/bin/bash -ex
          python-mlib/mlib.py organise_movies --movies TV --move -v3 {library-dir} {search-dir}

    publishers:
      - email:
          recipients: '{recipients}'
